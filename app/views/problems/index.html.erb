<% provide(:title, 'Problems') %>
<h1>Problems</h1>

<% if current_user.admin? %>
	<%= link_to "Create", new_problem_path, class: 'btn btn-primary' %>
<% end %>

<%= content_tag :div, class: 'panel-group', id: 'accordion', role: 'tablist', 'aria-multiselectable' => 'true' do %>
	<% @problems.order!(category: 'ASC', points: 'ASC') %>
	<% for @problem in @problems do %>

		<% if !@category || @category != @problem.category %>
			<% @category = @problem.category %>
			<h3><%= @category %></h3>
		<% end %>
		<%= content_tag :div, class: 'panel panel-default' do %>
			<%= content_tag :div, class: 'panel-heading', role: 'tab', id: "heading_" + @problem.id.to_s do %>
				<%= content_tag :h4, class: 'panel-title' do %>
					<div class="row">
						<%= content_tag :a, class: 'col-md-9 navbar-btn', role: 'button', 'data-toggle' => 'collapse', 'data-parent' => '#accordion', href: '#' + @problem.id.to_s, 'aria-expanded' => 'true', 'aria-controls' => @problem.id.to_s do %>
        			<%= @problem.name %> : <%= @problem.points.to_s %>
							<% if !current_user.admin? && @problem.solved_by?(current_user.team_id) %>
								| SOLVED
							<% end %>
						<% end %>
						<div class="col-md-3 text-right">
 							<% if current_user.admin? %>
   							<%= link_to "edit", edit_problem_path(@problem), class: 'btn btn-primary' %>
   							<%= link_to "delete", @problem, method: :delete,
                             	 				data: { confirm: "You sure?" },
															  			class: 'btn btn-primary' %>
							<% end %>
						</div>
					</div>
    		<% end %>
    	<% end %>
			<%= content_tag :div, id: @problem.id.to_s, class: 'panel-collapse collapse', role: 'tabpanel', 'aria-labelledby' => 'heading_' + @problem.id.to_s do %> 
				<%= content_tag :div, class: 'panel-body' do %>
					<%= render @problem %>
    		<% end %>
    	<% end %>
		<% end %>
	<% end %>
<% end %>

